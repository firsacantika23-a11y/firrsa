<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Photo Booth</title>
    
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        /* ================================= */
        /*          CSS VARIABLES           */
        /* ================================= */
        :root {
            --bg-color: #121212;
            --surface-color: #1e1e1e;
            --primary-color: #bb86fc;
            --secondary-color: #03dac6;
            --on-surface-color: #ffffff;
            --text-color: #e0e0e0;
            --font-family: 'Poppins', sans-serif;
        }

        /* ================================= */
        /*            GLOBAL STYLES          */
        /* ================================= */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        /* Background animasi */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #bb86fc, #03dac6, #cf6679, #3700b3);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            opacity: 0.1;
            z-index: -1;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* ================================= */
        /*          MAIN CONTAINER           */
        /* ================================= */
        .app-container {
            width: 90%;
            max-width: 600px;
            background-color: var(--surface-color);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            padding: 30px;
            text-align: center;
            position: relative;
        }

        h1 {
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 2.2rem;
        }

        /* ================================= */
        /*           UI SECTIONS            */
        /* ================================= */
        #start-screen, #camera-view, #final-result {
            display: none;
        }

        #start-screen.active, #camera-view.active, #final-result.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Viewfinder & Film Strip */
        .viewfinder-container {
            position: relative;
            width: 100%;
            aspect-ratio: 4 / 5;
            background-color: #000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }

        #countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10rem;
            font-weight: 700;
            color: var(--secondary-color);
            text-shadow: 0 0 20px rgba(3, 218, 198, 0.7);
            display: none;
            animation: pulse 1s ease-in-out;
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }

        .film-strip {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .film-strip .placeholder {
            width: 60px;
            height: 80px;
            border: 2px dashed var(--primary-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 2rem;
        }

        .film-strip img {
            width: 60px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid var(--secondary-color);
            animation: snapIn 0.3s ease-out;
        }

        @keyframes snapIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Final Result */
        #final-strip-img {
            width: 100%;
            border-radius: 15px;
            border: 5px solid var(--on-surface-color);
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
        }

        /* ================================= */
        /*            BUTTONS               */
        /* ================================= */
        .btn {
            padding: 12px 25px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: var(--bg-color);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(187, 134, 252, 0.4);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--text-color);
            border: 2px solid var(--text-color);
        }

        .btn-secondary:hover {
            background-color: var(--text-color);
            color: var(--bg-color);
        }

        /* ================================= */
        /*            FILTERS                */
        /* ================================= */
        .filter-controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .filter-btn {
            padding: 8px 15px;
            background-color: var(--bg-color);
            color: var(--text-color);
            border: 1px solid #444;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .filter-btn.active {
            background-color: var(--primary-color);
            color: var(--bg-color);
            border-color: var(--primary-color);
        }

        .filter-btn:hover:not(.active) {
            border-color: var(--primary-color);
        }
        
        /* Canvas untuk proses gambar, disembunyikan */
        #canvas {
            display: none;
        }
    </style>
</head>
<body>

    <div class="app-container">
        <h1>ðŸ“¸ Modern Photo Booth</h1>

        <!-- Layar Awal -->
        <div id="start-screen" class="active">
            <p style="margin-bottom: 30px;">Buat 4 foto instan yang seru!</p>
            <button id="start-btn" class="btn btn-primary">Mulai Sesi Foto</button>
        </div>

        <!-- Tampilan Kamera -->
        <div id="camera-view">
            <div class="viewfinder-container">
                <video id="video" autoplay></video>
                <div id="countdown"></div>
            </div>
            
            <div class="film-strip" id="film-strip">
                <!-- Placeholder untuk foto -->
                <div class="placeholder">ðŸ“·</div>
                <div class="placeholder">ðŸ“·</div>
                <div class="placeholder">ðŸ“·</div>
                <div class="placeholder">ðŸ“·</div>
            </div>

            <div class="filter-controls">
                <button class="filter-btn active" data-filter="none">Normal</button>
                <button class="filter-btn" data-filter="grayscale(100%)">B/W</button>
                <button class="filter-btn" data-filter="sepia(100%)">Sepia</button>
                <button class="filter-btn" data-filter="contrast(150%)">Kontras</button>
                <button class="filter-btn" data-filter="saturate(200%)">Saturasi</button>
                <button class="filter-btn" data-filter="hue-rotate(90deg)">Hue</button>
            </div>
        </div>

        <!-- Hasil Akhir -->
        <div id="final-result">
            <p style="margin-bottom: 20px;">Hasil fotomu sudah jadi!</p>
            <img id="final-strip-img" src="" alt="Final Photo Strip">
            <div style="margin-top: 30px; display: flex; justify-content: center; gap: 15px;">
                <button id="download-btn" class="btn btn-primary">ðŸ’¾ Download</button>
                <button id="restart-btn" class="btn btn-secondary">ðŸ”„ Foto Lagi</button>
            </div>
        </div>
    </div>

    <!-- Canvas untuk pemrosesan gambar, tidak terlihat -->
    <canvas id="canvas"></canvas>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Elemen DOM
            const startScreen = document.getElementById('start-screen');
            const cameraView = document.getElementById('camera-view');
            const finalResult = document.getElementById('final-result');
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const countdownEl = document.getElementById('countdown');
            const filmStrip = document.getElementById('film-strip');
            const finalStripImg = document.getElementById('final-strip-img');

            // Tombol
            const startBtn = document.getElementById('start-btn');
            const downloadBtn = document.getElementById('download-btn');
            const restartBtn = document.getElementById('restart-btn');
            const filterBtns = document.querySelectorAll('.filter-btn');

            // State Aplikasi
            let stream = null;
            let capturedImages = [];
            const TOTAL_PHOTOS = 4;
            let currentFilter = 'none';
            let isSessionActive = false;

            // --- EVENT LISTENERS ---
            startBtn.addEventListener('click', startSession);
            downloadBtn.addEventListener('click', downloadStrip);
            restartBtn.addEventListener('click', resetApp);
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    video.style.filter = currentFilter;
                });
            });

            // --- FUNGSI-FUNGSI UTAMA ---
            async function startSession() {
                if (isSessionActive) return;
                isSessionActive = true;
                
                startScreen.classList.remove('active');
                cameraView.classList.add('active');
                
                try {
                    stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    video.srcObject = stream;
                    // Tunggu video dimuat sebelum memulai sesi
                    video.onloadedmetadata = () => {
                        captureNextPhoto();
                    };
                } catch (err) {
                    console.error("Error accessing webcam:", err);
                    alert("Tidak dapat mengakses webcam. Pastikan izin telah diberikan.");
                    resetApp();
                }
            }

            function captureNextPhoto() {
                if (capturedImages.length >= TOTAL_PHOTOS) {
                    processFinalStrip();
                    return;
                }

                // Tampilkan countdown
                showCountdown(3, () => {
                    // Ambil foto setelah countdown selesai
                    takePhoto();
                });
            }

            function showCountdown(count, callback) {
                countdownEl.style.display = 'block';
                countdownEl.innerText = count;
                
                if (count > 0) {
                    setTimeout(() => showCountdown(count - 1, callback), 1000);
                } else {
                    countdownEl.innerText = 'CHEESE!';
                    setTimeout(() => {
                        countdownEl.style.display = 'none';
                        callback();
                    }, 500);
                }
            }

            function takePhoto() {
                // Efak kilat
                video.style.opacity = '0';
                setTimeout(() => video.style.opacity = '1', 200);

                // Siapkan canvas untuk menangkap gambar
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                // Terapkan filter dan gambar ke canvas
                ctx.filter = currentFilter;
                ctx.drawImage(video, 0, 0);

                // Simpan hasil gambar
                const imageData = canvas.toDataURL('image/png');
                capturedImages.push(imageData);

                // Update UI film strip
                updateFilmStrip();

                // Lanjut ke foto berikutnya
                setTimeout(() => captureNextPhoto(), 1000); // Jeda 1 detik
            }

            function updateFilmStrip() {
                const placeholders = filmStrip.querySelectorAll('.placeholder');
                const photoIndex = capturedImages.length - 1;
                if (placeholders[photoIndex]) {
                    placeholders[photoIndex].outerHTML = `<img src="${capturedImages[photoIndex]}" alt="Captured ${photoIndex + 1}">`;
                }
            }

            function processFinalStrip() {
                // Hentikan stream kamera
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                }

                // Sembunyikan tampilan kamera, tampilkan hasil
                cameraView.classList.remove('active');
                finalResult.classList.add('active');

                // Siapkan canvas untuk strip final
                const STRIP_WIDTH = 600;
                const STRIP_HEIGHT = 1200;
                canvas.width = STRIP_WIDTH;
                canvas.height = STRIP_HEIGHT;

                // Gambar latar belakang
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, STRIP_WIDTH, STRIP_HEIGHT);

                // Gambar judul
                ctx.fillStyle = '#121212';
                ctx.font = 'bold 50px Poppins';
                ctx.textAlign = 'center';
                ctx.fillText('MODERN BOOTH', STRIP_WIDTH / 2, 80);

                // Gambar 4 foto
                const photoWidth = 250;
                const photoHeight = (photoWidth / video.videoWidth) * video.videoHeight;
                const spacing = (STRIP_WIDTH - (2 * photoWidth)) / 3;
                
                capturedImages.forEach((imgSrc, index) => {
                    const img = new Image();
                    img.onload = () => {
                        const x = index % 2 === 0 ? spacing : spacing * 2 + photoWidth;
                        const y = 120 + Math.floor(index / 2) * (photoHeight + 30);
                        
                        // Gambar border putih
                        ctx.fillStyle = '#ffffff';
                        ctx.fillRect(x - 10, y - 10, photoWidth + 20, photoHeight + 20);
                        
                        // Gambar foto
                        ctx.drawImage(img, x, y, photoWidth, photoHeight);
                    };
                    img.src = imgSrc;
                });

                // Tambahkan teks footer
                setTimeout(() => { // Beri jeda agar gambar ter-render sempurna
                    ctx.fillStyle = '#777';
                    ctx.font = '25px Poppins';
                    ctx.fillText(new Date().toLocaleString('id-ID'), STRIP_WIDTH / 2, STRIP_HEIGHT - 40);
                    
                    // Tampilkan hasil di elemen img
                    finalStripImg.src = canvas.toDataURL('image/png');
                }, 500);
            }

            function downloadStrip() {
                const link = document.createElement('a');
                link.href = finalStripImg.src;
                link.download = `modern-photobooth-${Date.now()}.png`;
                link.click();
            }

            function resetApp() {
                isSessionActive = false;
                capturedImages = [];
                
                // Reset UI
                startScreen.classList.add('active');
                cameraView.classList.remove('active');
                finalResult.classList.remove('active');
                
                // Reset film strip
                filmStrip.innerHTML = `
                    <div class="placeholder">ðŸ“·</div>
                    <div class="placeholder">ðŸ“·</div>
                    <div class="placeholder">ðŸ“·</div>
                    <div class="placeholder">ðŸ“·</div>
                `;
                
                // Reset video
                video.srcObject = null;
            }
        });
    </script>
</body>
</html>
